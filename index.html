<html>
  <head>
  </head>
  <body>
  
      </div>
      <textarea id="textarea-0" placeholder="Type here.."></textarea>
      <!-- style="width: 100%; height: 50%" -->
      <div id="div-0"></div>
    </div>

    <script src="blocksdk.js"></script>
    <script>
      const debounce = (fn, delay) => {
        let timeOutID;
        return function (...args) {
          if (timeOutID) {
            clearTimeout(timeOutID);
          }
          timeOutID = setTimeout(() => {
            fn(...args);
          }, delay);
        };
      };

      var sdk = new window.sfdc.BlockSDK({
        blockEditorWidth: 600,
        tabs: ["htmlblock", "stylingblock"],
      });


      textBlockHTML = `<table cellpadding="0 " cellspacing="0 " width="100% " role="presentation " style="min-width: 100%;  "
    class="stylingblock-content-wrapper ">
                        <tr>
                            <td class="stylingblock-content-wrapper camarker-inner ">
                                <table width="100% " height="100% " cellspacing="0 " cellpadding="0 ">
                                    <tr>
                                        <td align="center ">
                                            <p style="background-color: #D3D3D3; height:50px; line-height:50px; white-space:nowrap; ">
                                                [GSDM Plain Text Block]
                                            </p>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>`
      
      textAreaHTML = `</div class="dm-rich-text-block editable no-text" data-dm-block-id="1615334367096" data-content="Click To Edit">
                    <textarea id="textarea-0" placeholder="Type here.."></textarea>
                    <div id="div-0"></div>
                  </div>`;

      textAreaAmpscriptHTML = `<table cellpadding="0" cellspacing="0" width="100%" role="presentation" style="min-width: 100%; "
                    class="stylingblock-content-wrapper">
                    <tr>
                        <td class="stylingblock-content-wrapper camarker-inner">%%[/* DO NOT TOUCH */\nSet @sfOrgId =
                            RegExMatch(AttributeValue("sfOrgId"),"(^[a-zA-Z0-9]{18}$)",1)\nSet @richText =
                            AttributeValue("1615334367095") /* Passed for the DM Email Preview */\nSet @objectId =
                            IIF(EMPTY(AttributeValue("sfCampaignMemberId")), AttributeValue("id"),
                            AttributeValue("sfCampaignMemberId"))\nSet @journeyId =
                            RegExMatch(AttributeValue("journeyId"),"(^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$)",1)\nSet
                            @personalizeDE = Concat("PersonalizationDE", "_" , @sfOrgId, "_", @journeyId)\nSet @personalizeId =
                            Concat(@objectId,_emailId,"1615334367095")\nIF EMPTY(@richText) THEN\n Set @richTextMsg =
                            Lookup(@personalizeDE,"value","id",@personalizeId)\nELSE THEN\n Set @richTextMsg = @richText\nENDIF\nSet
                            @richTextMsg = Concat('<div class="dm-rich-text-block" data-dm-block-id="1615334367095">', @richTextMsg,
                                '</div>')\n]%%\n%%=v(@richTextMsg)=%%\n%%[*/ DO NOT TOUCH */]%%</td>
                    </tr>
                </table>`;

      sdk.setSuperContent(textBlockHTML);
      sdk.setContent(textAreaAmpscriptHTMLs);
      /* -SET METADATA START- */
      var customBlockData = new Object();
      customBlockData.dmRichTextBlock = new Object();
      customBlockData.dmRichTextBlock.dmBlockId = 1615334367096;
      customBlockData.dmRichTextBlock.version = 1;
      customBlockData.dmRichTextBlock.selectionName = "GSDM Free Text Block";
      customBlockData.dmRichTextBlock.description = "Enter content here" ;
      customBlockData.dmRichTextBlock.charLimit = "4000"
      
      sdk.setData(customBlockData, function(data) {
        console.log('Received metadata from setData ==> ' + JSON.stringify(data));
      });

      /* -END- */

      sdk.setBlockEditorWidth("500px", function (data) {
        console.log("setBlockEditorWidth --> " + JSON.stringify(data));
      });

      sdk.getData(function (data) {});
      sdk.getContent(function (data) {
        if (data) {
          document.getElementById("textarea-0").value = data;
        }
      });

      sdk.getCentralData(function (centralData) {
        console.log("Get Central Data : " + JSON.stringify(centralData));
      });

      sdk.getUserData(function (userData) {
        console.log("Get User Data : " + JSON.stringify(userData));
      });
      var textAreaContent;

      function sendDatatoMC() {
        textAreaContent = document.getElementById("textarea-0").value;
        sdk.setSuperContent(textAreaContent);
        sdk.setContent(textAreaContent);
         /* -SET METADATA START- */
      var customBlockData = new Object();
      customBlockData.dmRichTextBlock = new Object();
      customBlockData.dmRichTextBlock.dmBlockId = 1615334367096;
      customBlockData.dmRichTextBlock.version = 1;
      customBlockData.dmRichTextBlock.selectionName = "GSDM Rich Text Block";
      customBlockData.dmRichTextBlock.description = "Enter content here" ;
      customBlockData.dmRichTextBlock.charLimit = "4000"
      
      sdk.setData(customBlockData, function(data) {
        console.log('Received metadata from setData ==> ' + JSON.stringify(data));
      });

      /* -END- */
      }
      //Event Listener
      document.getElementById("textarea-0").addEventListener(
        "input",
        debounce((e) => {
          document.getElementById("div-0").innerHTML =
            '<font face="verdana">(' +
            document.getElementById("textarea-0").value.length +
            "/4000) " +
            (4000 - document.getElementById("textarea-0").value.length) +
            " characters left." +
            "</font>";
          sendDatatoMC();
        }, 500)
      );
      document.getElementById("div-0").innerHTML =
        '<font face="verdana">(' +
        document.getElementById("textarea-0").value.length +
        "/4000) " +
        (4000 - document.getElementById("textarea-0").value.length) +
        " characters left." +
        "</font>";
    </script>
  </body>
</html>
