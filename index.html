<!--
  TODO:
  1. Debounce login instead of onchange
  2. Icon file change
  --><html>
  <head></head>
  <body>
  <div id='textarea'>

    <textarea id='textarea-0' placeholder='type here..' onchange="textAreaEventListner()"></textarea>  <!-- onchange="textAreaChange()"--> 
    <div id='div-0'></div>
    </div>
  
    <script src="blocksdk.js"></script>
    <script>

    const debounce = (fn, delay) => {
      let timeOutID;
      return function(...args) {
        if(timeOutID) { 
          clearTimeout(timeOutID); 
        }
        timeOutID = setTimeout( ()=> {
          fn(...args) 
        },delay);
      }
    };
    
    var sdk = new window.sfdc.BlockSDK({
           blockEditorWidth: 600,
           tabs: [
               'htmlblock', 
               'stylingblock' 
           ]
      }
      );

    sdk.getData(function (data) {
      console.log("data in getData --> " + data);
      //TODO: Set quilljs default value
      if(data) { 
        document.getElementById('textarea-0').value = data;
      }

    }); 
    sdk.getContent(function (data) {
      console.log("data in getContent --> " + data);
      }); 

    sdk.getCentralData(function(centralData) {
      console.log('Get Central Data : ' + JSON.stringify(centralData));
    });

    sdk.getUserData(function(userData) {
      console.log('Get User Data : ' + JSON.stringify(userData));
    });


      /* var localStorageValue = localStorage.getItem('textarea-0-cache') ;
      if(localStorageValue) { 
        document.getElementById('div-0').innerHTML = localStorageValue;
        document.getElementById('textarea-0').value = localStorageValue;
        }*/
      var textAreaContent ;
      // do something with the sdk
      //functions
      /* function debounce (func, wait, immediate) {
        var timeout;
        return function() {
          var context = this, args = arguments;
          var later = function() {
            timeout = null;
            if (!immediate) func.apply(context, args);
          };
          var callNow = immediate && !timeout;
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
          if (callNow) func.apply(context, args);
        };
      }
      */

      /* sdk.getData( 
          function(textAreaContent) 
          {
            console.log('[debug]: Get Data method' + JSON.stringify(textAreaContent)); //This is not setting any data.
            //setting default values
            document.getElementById('textarea-0').value = textAreaContent + " - set value";
            textAreaChange();
          }
      );  
      sdk.getContent( 
          function(textAreaContent) 
          {
            console.log('[debug]: Get Data method' + JSON.stringify(textAreaContent)); //This is not setting any data.
            //setting default values
            document.getElementById('textarea-0').value = textAreaContent + " - set value";
            textAreaChange();
          }
      );  */
      function sendDatatoMC() {
        textAreaContent = document.getElementById('textarea-0').value;
        //console.log('Text Area Change function called.')
        //setting super content (for preview)
        sdk.setSuperContent(textAreaContent); 
        sdk.setContent(textAreaContent); 
        sdk.setData(textAreaContent); 

        console.log('Super Text Content is --> ' + textAreaContent);

        //Setting DIV tag & cache
       /* document.getElementById('div-0').innerHTML = textAreaContent;
        document.getElementById('textarea-0').value =textAreaContent;
        localStorage.setItem('textarea-0-cache', textAreaContent);
        //printing sdk object
        console.log('SDK object after setting local storage --> ' + JSON.stringify(sdk));
*/


      }


      //TODO: get default value if available and set them
      /* var textAreaElement = document.getElementById('textarea-0');
      if (textAreaElement) { 
        textAreaElement.addEventListener("input", te);
      }*/
      //Printing SDK after initilisation
      console.log('SDK object on initilisation--> ' + JSON.stringify(sdk) );


    //Event Listener

    document.getElementById('textarea-0').addEventListener('input', debounce (e => {
      console.log("Debounce done. Calling sendDatatoMC function.");
      document.getElementById('div-0').innerHTML = '<font face="verdana">(' + document.getElementById('textarea-0').value.length + '/4000) ' + (4000 - document.getElementById('textarea-0').value.length) + ' characters left.' + '</font>';
      sendDatatoMC();
      //saveQuillHTML();
      },500));
      
    document.getElementById('div-0').innerHTML = '<font face="verdana">(' + document.getElementById('textarea-0').value.length + '/4000) ' + (4000 - document.getElementById('textarea-0').value.length) + ' characters left.' + '</font>';

      
    </script>
    </body>
</html>